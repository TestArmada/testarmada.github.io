---
layout: gettingStarted
title:  "Using Nightwatch-extra"
link: "usingNightwatchextra"
tags: 
 - name: Create test
   link: createNightwatchTest
 - name: Extend the base test
   link: extendBaseTest
 - name: Customize command
   link: customizeTestCommand
 - name: Customize assertion
   link: customizeTestAssertion
 - name: Page Object
   link: pageObject
 - name: Accelerate test execution
   link: accelerateTestExecution
category: Developer Guide
---

{:name="link-content"}
## Using Nightwatch-extra
---

{:id="createNightwatchTest"}
{:name="link-content"}
### Create test

{:.description}
_Nightwatch-extra_ supports everything that nightwatchjs supports. Please refer to [nightwatchjs' developer guide](http://nightwatchjs.org/guide#using-nightwatch) for the basic usage of nightwatchjs.

{:id="extendBaseTest"}
{:name="link-content"}
### Extend the base-test-class.js

{:.description}
_Nightwatch-extra_'s `base-test-class.js` passes certain information, such as selenium session information and test result, back to _magellan_. We highly recommend all your tests extend it.

<script src="https://gist.github.com/archlichking/e03a9a91c98c13c42cc37601d32855e1.js"></script>

{:.description}
You can override `before()`, `beforeEach()`, `afterEach()` and `after()` method or add your own base test methods by extending the `base-test-class.js`. To create your own base test, simple inherit your test from [base-test-class.js](https://github.com/TestArmada/nightwatch-extra/blob/master/src/base-test-class.js).

<script src="https://gist.github.com/archlichking/5bb21dd62e2a540fa78e2bfb5db588db.js"></script>

{:.description}
Then create your new test from `MyBaseTest` instead of `base-test-class.js`

<script src="https://gist.github.com/archlichking/66ea695c944b05218b25f6df56881f9a.js"></script>


{:id="customizeTestCommand"}
{:name="link-content"}
### Customize command

{:.description}
_Nightwatch-extra_ provides two sets of command API, one for browser test and one for app test. Please refer to [API Reference](#API) to get more information. To use _nightwatch-extra_'s command API, you need to add its path to `nightwatch.json`

<code data-gist-id="557c10f8cf51e41c3f73293e98ee9044" data-gist-line="6-8,10"></code>

{:.description}
A typical flow of how _nightwatch-extra_'s command works is 

{:.list}
{:.description}
1). Get all information, like selector, values, callback, from `command()` method's arguments.

{:.list}
{:.description}
2). Check element's apparence. If element isn't present or isn't visible within given time, fail the command.

{:.list}
{:.description}
3). Invoke customized code to get element information (via `injectedJsCommand()` for browser test command).

{:.list}
{:.description}
4). Expose element handler to user to do extra things to the element via `do()`. 


{:.description}
All commands of _nightwatch-extra_ won't proceed if either of the following conditions isn't met.

{:.list}
{:.description}
1). The element you want to operate is in the DOM (or it's in the doc tree in app test).

{:.list}
{:.description}
2). The element you want to operate is visible in the view port.

#### Implement a browser test command

{:.description}
We provide a [base-command.js](https://github.com/TestArmada/nightwatch-extra/blob/master/src/base-command.js) for inheritance to implement your own command for browser test. To implement a command for browser usage, you need to

{:.list}
{:.description}
1). Inherit your command from the `base-command.js`.

{:.list}
{:.description}
2). Implement method `injectedJsCommand()`, `do()` and `command()` as documented [here](https://github.com/TestArmada/nightwatch-extra/blob/master/src/base-command.js#L233-L262).

{:.table.table-condensed.table-hover}
| Method | Purpose | Arguments |
|:----------|:----------|:-----------|
| `injectedJsCommand($el)` | The piece of javascript injected into the web page to get element information, such as element's textual value | _$el_ is the javascript object representing the html element. |
| `do(magellanSelector)` | Called by base test if element exists and is visible, you can do you own things in this method. | _magellanSelector_ is the selector you should use which is generated by _nightwatch-extra_ |
| `command(..., callback)`  | The command signature which user will use in their test | Parameter amount can be arbitary with an optional callback which will be called when the command successfully finishes.|

{:.list}
{:.description}
3). Add the path of your new command to `nightwatch.json`

<code data-gist-id="557c10f8cf51e41c3f73293e98ee9044" data-gist-line="6-10"></code>

{:.description}
You can use all [browser commands](https://github.com/TestArmada/nightwatch-extra/tree/master/src/commands) provided by _nightwatch-extra_ as example to build your own browser test command.

#### Implement an app test command

{:.description}
We provide a [base-mobile-command.js](https://github.com/TestArmada/nightwatch-extra/blob/master/src/base-mobile-command.js) for inheritance to implement your own command for app test. To implement a command for app usage, you need to

{:.list}
{:.description}
1). Inherit your command from `base-mobile-command.js`.

{:.list}
{:.description}
2). Implement method `do()` and `command()` as documented [here](https://github.com/TestArmada/nightwatch-extra/blob/master/src/base-mobile-command.js#L102-L119).

{:.table.table-condensed.table-hover}
| Method | Purpose | Arguments |
|:----------|:----------|:-----------|
| `do(elementInfo)` | Called by base test if element exists and is visible, you can do you own things in this method. | _elementInfo_ is the element information returned by appium server |
| `command(..., callback)`  | The command signature which user will use in their test | Parameter amount can be arbitary with an optional callback which will be called when the command successfully finishes.|

{:.list}
{:.description}
3). Add the path of your new command to `nightwatch.json`

{:.description}
You can use all the [app commands](https://github.com/TestArmada/nightwatch-extra/tree/master/src/commands/mobile) provided by _nightwatch-extra_ as example to build your own app test command.

{:id="customizeTestAssertion"}
{:name="link-content"}
### Customize assertion

{:.description}
_Nightwatch-extra_ provides two sets of assertion API, one for browser test and one for app test. Please refer to [API Reference](#API) to get more information. To use _nightwatch-extra_'s assertion API, you need to add its path to `nightwatch.json`

<code data-gist-id="557c10f8cf51e41c3f73293e98ee9044" data-gist-line="11-13,15"></code>

{:.description}
A typical flow of how _nightwatch-extra_'s assertion works is 

{:.list}
{:.description}
1). Get all information, like selector, expectedValue, callback, from `command()` method's arguments.

{:.list}
{:.description}
2). Check element's apparence. If element isn't present or isn't visible within given time, fail the command.

{:.list}
{:.description}
3). Invoke customized code to get element information (via `injectedJsCommand()` for browser test command).

{:.list}
{:.description}
4). Expose element handler to user to do extra things to the element and assert via `assert()`. 


{:.description}
All assertions of _nightwatch-extra_ won't proceed if either of the following conditions isn't met.

{:.list}
{:.description}
1). The element you want to operate is in the DOM (or it's in the doc tree in app test).

{:.list}
{:.description}
2). The element you want to operate is visible in the view port.

#### Implement a browser test assertion

{:.description}
We provide a [base-assertion.js](https://github.com/TestArmada/nightwatch-extra/blob/master/src/base-assertion.js) for inheritance to implement your own assertion for browser test. To implement an assertion for browser test, you need to

{:.list}
{:.description}
1). Inherit your assertion from the `base-assertion.js`.

{:.list}
{:.description}
2). Implement method `injectedJsCommand()`, `assert()` and `command()` as documented [here](https://github.com/TestArmada/nightwatch-extra/blob/master/src/base-assertion.js#L225-L254).

{:.table.table-condensed.table-hover}
| Method | Purpose | Arguments |
|:----------|:----------|:-----------|
| `injectedJsCommand($el)` | The piece of javascript injected into the web page to get element information, such as element's textual value | _$el_ is the javascript object representing the html element. |
| `assert(actual, expected)` | Called by base assertion if element exists and is visible, you can do you own assertion in this method. | _actual_ is the actual value returned by `injectedJsCommand()` method, _expected_ is the expected value passed in `command()` method |
| `command(selector, expected, ..., callback)`  | The command signature which user will use in their test | Parameter amount can be arbitary with a selector, an expected value and an optional callback which will be called when the assertion successfully finishes.|

{:.list}
{:.description}
3). Add the path to your new assertion to `nightwatch.json`

<code data-gist-id="557c10f8cf51e41c3f73293e98ee9044" data-gist-line="11-15"></code>

{:.description}
You can use all the [browser assertions](https://github.com/TestArmada/nightwatch-extra/tree/master/src/assertions) provided by _nightwatch-extra_ as example to build your own browser test assertion.

#### Implement an app test assertion

{:.description}
We provide a [base-mobile-assertion.js](https://github.com/TestArmada/nightwatch-extra/blob/master/src/base-mobile-assertion.js) for inheritance to implement your own assertion for app test. To implement an assertion for app test, you need to

{:.list}
{:.description}
1). Inherit your assertion from the `base-mobile-assertion.js`.

{:.list}
{:.description}
2). Implement method `do()`, `assert()` and `command()` as documented [here](https://github.com/TestArmada/nightwatch-extra/blob/master/src/base-mobile-assertion.js#L95-L119).


{:.table.table-condensed.table-hover}
| Method | Purpose | Arguments |
|:----------|:----------|:-----------|
| `do(elementInfo)` | Called by base assertion if element exists and is visible, you can do you own things in this method. | _elementInfo_ is the element information returned by appium server |
| `assert(actual, expected)` | Called by base assertion if element exists and is visible, you can do you own assertion in this method. | _actual_ is the actual value returned by `do()` method, _expected_ is the expected value passed in `command()` method |
| `command(selector, expected, ..., callback)`  | The command signature which user will use in their test | Parameter amount can be arbitary with a selector, an expected value and an optional callback which will be called when the assertion successfully finishes.|

{:.list}
{:.description}
3). Add the path to your new assertion to `nightwatch.json`

{:.description}
You can use all the [app assertions](https://github.com/TestArmada/nightwatch-extra/tree/master/src/assertions/mobile) provided by _nightwatch-extra_ as example to build your own app test assertion.

{:id="pageObject"}
{:name="link-content"}
### Page Object

{:.description}
_Nightwatch-extra_ is fully compatible with _nightwatchjs_' [page object](http://nightwatchjs.org/guide#page-objects) pattern. You can access _nightwatch-extra_'s API or your customized API in page object command via

<code data-gist-id="c967083c8059ebe7a1a0ae457876c3f8" data-gist-line="2-7"></code>

{:.description}
All _nightwatchjs_' APIs are accessible and chainable with _nightwatch-extra_'s API or your customized API via  

<code data-gist-id="c967083c8059ebe7a1a0ae457876c3f8" data-gist-line="9-16"></code>

{:id="accelerateTestExecution"}
{:name="link-content"}
### Accelerate test execution

{:.description}
_Nightwatch-extra_ relies on javascript injection to unify the element detection experience across browsers with [sizzlejs](https://sizzlejs.com/). Selenium's `/execute` and `/execute_async` API are heavily in use in this case. We provide both synchronous and asynchronous javascript injection for `/execute` and `/execute_async`. 

{:.description}
> _Extensive reading_:

{:.description}
> <[Accelerate Web Test Automation, Part 1](https://medium.com/walmartlabs/accelerate-web-test-automation-part-1-e574f31938d1)> on Medium.

{:.description}
> <[Accelerate Web Test Automation, Part 2](https://medium.com/walmartlabs/accelerate-web-test-automation-part-2-bd5833fa01b4)> on Medium.

{:.description}
The synchronous version of javascript injection is for `/execute` API and it works for all browsers. However because of the nature of synchronization, the execution speed of using `/execute` is much slower than its asynchronous cousin. We recommend using `/execute_async` as much as you can unless

{:.list}
{:.description}
1). You're testing against some latest desktop browsers who don't support `/execute_async` API, like Safari@10.

{:.list}
{:.description}
2). You're testing against some mobile browsers whose javascript engine is out of date.

{:.description}
_Nightwatch-extra_ uses `/execute_async` by default. There are two ways to switch to `/execute`

{:.list}
{:.description}
1). Via command line argument `--sync_browsers`

{:.description}
The following code tells _nightwatch-extra_ to use `/execute` API for all versions of safari
<pre>
    <code class="code-wrap bash">./node_modules/.bin/magellan --sync_browsers safari</code>
</pre>

{:.description}
The following code tells _nightwatch-extra_ to use `/execute` API for safari@10 only
<pre>
    <code class="code-wrap bash">./node_modules/.bin/magellan --sync_browsers safari:10</code>
</pre>

{:.list}
{:.description}
2). Via `nightwatch.json`

{:.description}
The following code tells _nightwatch-extra_ to use `/execute` API for all safari@10 and all versions of chrome

<code data-gist-id="557c10f8cf51e41c3f73293e98ee9044" data-gist-line="46-49"></code>